<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kh√°m Ph√° ƒêa Th·ª©c M·ªôt Bi·∫øn</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Th√™m th∆∞ vi·ªán DragDropTouch ƒë·ªÉ h·ªó tr·ª£ k√©o th·∫£ m∆∞·ª£t m√† tr√™n ƒëi·ªán tho·∫°i/m√°y t√≠nh b·∫£ng -->
    <script src="https://bernardo-castilho.github.io/DragDropTouch/DragDropTouch.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Quicksand', sans-serif; background: #f0f7ff; }
        /* Th√™m touch-action: none v√† user-select: none ƒë·ªÉ kh√¥ng b·ªã cu·ªôn trang hay b√¥i ƒëen ch·ªØ khi k√©o tr√™n ƒëi·ªán tho·∫°i */
        .card { transition: all 0.3s ease; cursor: grab; touch-action: none; user-select: none; }
        .card:active { cursor: grabbing; scale: 1.05; }
        .drop-zone { min-height: 200px; transition: background 0.3s; }
        .notebook { 
            background: #fff;
            background-image: radial-gradient(#d1d1d1 1px, transparent 1px);
            background-size: 20px 20px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.1);
            border-left: 10px solid #3b82f6;
        }
        .math-text { font-family: 'Times New Roman', serif; font-style: italic; }
        
        /* Th√™m hi·ªáu ·ª©ng rung l·∫Øc khi b·∫•m sai ·ªü Th·ª≠ th√°ch 2 */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-5deg); }
            75% { transform: translateX(5px) rotate(5deg); }
        }
        .animate-shake { animation: shake 0.4s ease-in-out; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div id="app" class="max-w-5xl mx-auto">
        
        <!-- PHASE 1: Ph√¢n lo·∫°i s·ªë l∆∞·ª£ng bi·∫øn -->
        <div id="phase-1">
            <header class="text-center mb-8">
                <div class="inline-block bg-blue-100 text-blue-800 px-4 py-1 rounded-full text-sm font-bold mb-3 shadow-sm">TH·ª¨ TH√ÅCH 1</div>
                <h1 class="text-4xl font-bold text-blue-700 mb-2">Nh√† Ph√¢n Lo·∫°i T√†i Ba üß©</h1>
                <p class="text-gray-600 italic">K√©o c√°c th·∫ª bi·ªÉu th·ª©c v√†o ƒë√∫ng nh√≥m d·ª±a tr√™n s·ªë l∆∞·ª£ng bi·∫øn!</p>
            </header>

            <div id="game-section-1" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Items to Drag -->
                <div class="bg-white p-4 rounded-2xl shadow-md">
                    <h2 class="font-bold text-center mb-4 text-gray-700 border-b pb-2">Kho Bi·ªÉu Th·ª©c</h2>
                    <div id="item-pool-1" class="flex flex-wrap gap-3 justify-center">
                        <!-- Cards injected here -->
                    </div>
                </div>

                <!-- Drop Zone 1 -->
                <div id="zone-single" class="drop-zone bg-blue-50 border-4 border-dashed border-blue-300 rounded-3xl p-4 flex flex-col items-center">
                    <div class="text-3xl mb-2">üë§</div>
                    <h3 class="font-bold text-blue-800 text-center uppercase text-sm mb-4">Ch·ªâ ch·ª©a 1 lo·∫°i bi·∫øn (x ho·∫∑c y...)</h3>
                    <div class="w-full space-y-2 flex flex-wrap gap-2 justify-center" id="single-variable-list"></div>
                </div>

                <!-- Drop Zone 2 -->
                <div id="zone-multi" class="drop-zone bg-purple-50 border-4 border-dashed border-purple-300 rounded-3xl p-4 flex flex-col items-center">
                    <div class="text-3xl mb-2">üë•</div>
                    <h3 class="font-bold text-purple-800 text-center uppercase text-sm mb-4">Ch·ª©a nhi·ªÅu lo·∫°i bi·∫øn kh√°c nhau</h3>
                    <div class="w-full space-y-2 flex flex-wrap gap-2 justify-center" id="multi-variable-list"></div>
                </div>
            </div>
        </div>

        <!-- Notebook Section (Hi·ªÉn th·ªã ngay sau Phase 1) -->
        <div id="notebook-section" class="mt-12 hidden opacity-0 transform translate-y-10 transition-all duration-700">
            <div class="notebook p-8 rounded-r-2xl relative overflow-hidden">
                <div class="absolute top-4 right-4 text-5xl opacity-10">üìñ</div>
                <h2 class="text-2xl font-bold text-blue-600 border-b-2 border-blue-100 pb-2 mb-6">üìî S·ªï Tay Ki·∫øn Th·ª©c Ch√¢n Tr·ªùi</h2>
                
                <div class="space-y-6">
                    <section>
                        <h3 class="text-xl font-semibold text-orange-600 flex items-center">
                            <span class="mr-2">üîπ</span> ƒê∆°n th·ª©c m·ªôt bi·∫øn
                        </h3>
                        <p class="text-gray-700 ml-6 mt-2">
                            L√† bi·ªÉu th·ª©c ƒë·∫°i s·ªë ch·ªâ g·ªìm <span class="font-bold">m·ªôt s·ªë</span>, ho·∫∑c <span class="font-bold">m·ªôt bi·∫øn</span>, ho·∫∑c m·ªôt <span class="font-bold">t√≠ch</span> gi·ªØa c√°c s·ªë v√† bi·∫øn ƒë√≥.
                            <br>
                            <span class="bg-orange-50 px-2 py-1 rounded italic">V√≠ d·ª•: 3, x, -2x, 5x¬≤, ...</span>
                        </p>
                    </section>

                    <section>
                        <h3 class="text-xl font-semibold text-blue-600 flex items-center">
                            <span class="mr-2">üîπ</span> ƒêa th·ª©c m·ªôt bi·∫øn
                        </h3>
                        <p class="text-gray-700 ml-6 mt-2">
                            L√† <span class="font-bold text-blue-700 underline">T·ªïng</span> c·ªßa nh·ªØng ƒë∆°n th·ª©c c·ªßa c√πng m·ªôt bi·∫øn.
                            <br>
                            <span class="bg-blue-50 px-2 py-1 rounded italic">V√≠ d·ª•: A(x) = 2x¬≤ + 3x - 5</span>
                        </p>
                        <div class="ml-6 mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-500 text-sm text-gray-800 rounded-r">
                            <strong>‚ö†Ô∏è Ch√∫ √Ω quan tr·ªçng:</strong>
                            <ul class="list-disc ml-5 mt-2 space-y-1">
                                <li>M·ªói ƒë∆°n th·ª©c m·ªôt bi·∫øn c≈©ng ƒë∆∞·ª£c xem l√† m·ªôt ƒëa th·ª©c m·ªôt bi·∫øn.</li>
                                <li>C√°c bi·ªÉu th·ª©c c√≥ ch·ª©a <strong>bi·∫øn ·ªü d∆∞·ªõi m·∫´u</strong> (VD: <span class="math-text">4/x</span>) ho·∫∑c <strong>bi·∫øn n·∫±m trong d·∫•u cƒÉn</strong> (VD: <span class="math-text">‚àöx</span>) th√¨ <strong>KH√îNG</strong> ph·∫£i l√† ƒëa th·ª©c.</li>
                            </ul>
                        </div>
                    </section>

                    <!-- Ph·∫ßn b·ªï sung ƒêa th·ª©c kh√¥ng -->
                    <section>
                        <h3 class="text-xl font-semibold text-purple-600 flex items-center">
                            <span class="mr-2">üîπ</span> ƒêa th·ª©c kh√¥ng
                        </h3>
                        <p class="text-gray-700 ml-6 mt-2">
                            S·ªë <span class="font-bold text-red-500 text-lg">0</span> c≈©ng ƒë∆∞·ª£c g·ªçi l√† m·ªôt ƒëa th·ª©c m·ªôt bi·∫øn v√† n√≥ ƒë∆∞·ª£c g·ªçi l√† <span class="font-bold">ƒëa th·ª©c kh√¥ng</span>.
                            <br>
                            <span class="text-sm text-gray-500 italic mt-2 inline-block">üí° L∆∞u √Ω: ƒêa th·ª©c kh√¥ng l√† ƒëa th·ª©c duy nh·∫•t <strong>kh√¥ng c√≥ b·∫≠c</strong>.</span>
                        </p>
                    </section>
                </div>
                
                <div id="notebook-actions" class="mt-8 text-center">
                    <p class="text-orange-600 font-bold mb-4">ƒê·ªçc k·ªπ s·ªï tay tr∆∞·ªõc khi b∆∞·ªõc v√†o Th·ª≠ th√°ch 2 nh√©!</p>
                    <button onclick="startPhase2()" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full shadow-lg hover:shadow-xl transition-all animate-bounce">
                        Ti·∫øn v√†o Th·ª≠ Th√°ch 2 üöÄ
                    </button>
                </div>
            </div>
        </div>

        <!-- PHASE 2: Nh·∫≠n di·ªán ƒêa th·ª©c (Game: T√¨m k·∫ª m·∫°o danh) -->
        <div id="phase-2" class="hidden mt-12">
            <header class="text-center mb-8">
                <div class="inline-block bg-red-100 text-red-800 px-4 py-1 rounded-full text-sm font-bold mb-3 shadow-sm">TH·ª¨ TH√ÅCH 2</div>
                <h1 class="text-4xl font-bold text-red-700 mb-2">Ti√™u Di·ªát K·∫ª M·∫°o Danh üïµÔ∏è‚Äç‚ôÇÔ∏è</h1>
                <p class="text-gray-600 italic">C√≥ nh·ªØng bi·ªÉu th·ª©c KH√îNG PH·∫¢I ƒëa th·ª©c 1 bi·∫øn ƒëang tr√† tr·ªôn. H√£y B·∫§M v√†o ch√∫ng ƒë·ªÉ lo·∫°i b·ªè!</p>
            </header>

            <div id="game-section-2" class="max-w-3xl mx-auto">
                <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-red-500">
                    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 border-b pb-4 gap-4">
                        <h2 class="font-bold text-gray-700 text-xl">Radar Qu√©t B·∫´y üì°</h2>
                        <div class="bg-red-100 text-red-700 px-4 py-2 rounded-lg font-bold text-sm sm:text-base animate-pulse">
                            M·ª•c ti√™u: Ti√™u di·ªát <span id="trap-count" class="text-xl">0</span> b·∫´y
                        </div>
                    </div>
                    <div id="item-pool-2" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-center">
                        <!-- Cards injected here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Ph·∫ßn ho√†n th√†nh b√†i h·ªçc (·∫©n ban ƒë·∫ßu) -->
        <div id="final-section" class="hidden mt-12 text-center pb-12">
            <h2 class="text-3xl font-bold text-green-600 mb-6">üéâ Ch√∫c m·ª´ng b·∫°n ƒë√£ v∆∞·ª£t qua m·ªçi th·ª≠ th√°ch! üéâ</h2>
            <button onclick="location.reload()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full transition shadow-lg">
                L√†m l·∫°i t·ª´ ƒë·∫ßu üîÑ
            </button>
        </div>
    </div>

    <script>
        // Data Phase 1: Ph√¢n lo·∫°i 1 bi·∫øn vs nhi·ªÅu bi·∫øn
        const expressions1 = [
            { id: 1, val: "2x", type: "single" },
            { id: 2, val: "-5x¬≤", type: "single" },
            { id: 3, val: "3x + y", type: "multi" },
            { id: 4, val: "x¬≤ - 2x + 5", type: "single" },
            { id: 5, val: "ab - 1", type: "multi" },
            { id: 6, val: "y¬≥ + 2y - 1", type: "single" },
            { id: 7, val: "x - z", type: "multi" },
            { id: 8, val: "7", type: "single" },
            { id: 9, val: "x", type: "single" },
            { id: 10, val: "x¬≤y", type: "multi" }
        ];

        // Data Phase 2: Nh·∫≠n di·ªán ƒêa th·ª©c 1 bi·∫øn vs KH√îNG ph·∫£i ƒëa th·ª©c
        const expressions2 = [
            { id: 11, val: "3x¬≤ - x", type: "poly" },
            { id: 12, val: "4/x + 2", type: "not_poly" }, // Bi·∫øn ·ªü m·∫´u
            { id: 13, val: "‚àöx - 5", type: "not_poly" }, // Bi·∫øn trong cƒÉn
            { id: 14, val: "x¬≥ + xy", type: "not_poly" }, // Ch·ª©a 2 bi·∫øn (kh√¥ng ph·∫£i ƒëa th·ª©c 1 bi·∫øn)
            { id: 15, val: "-15", type: "poly" }, // ƒêa th·ª©c b·∫≠c 0
            { id: 16, val: "y‚Å¥ - 2y + 1", type: "poly" },
            { id: 17, val: "0", type: "poly" } // Th√™m ƒêa th·ª©c kh√¥ng v√†o th·ª≠ th√°ch 2
        ];

        let completedCount1 = 0;
        let trapsFound = 0;
        let totalTraps = 0;
        const notebook = document.getElementById('notebook-section');

        // H√†m t·∫°o th·∫ª k√©o th·∫£
        function createCard(expr, isPhase1 = true) {
            const card = document.createElement('div');
            card.className = "card bg-white border-2 border-gray-200 px-4 py-2 rounded-xl shadow-sm text-lg math-text font-bold text-gray-800";
            card.draggable = true;
            card.innerText = expr.val;
            card.dataset.id = expr.id;
            card.dataset.type = expr.type;
            
            card.addEventListener('dragstart', (e) => {
                e.dataTransfer.setData('text/plain', expr.id);
                e.dataTransfer.setData('phase', isPhase1 ? '1' : '2');
                card.classList.add('opacity-50');
            });

            card.addEventListener('dragend', () => card.classList.remove('opacity-50'));
            return card;
        }

        // --- PHASE 1 LOGIC ---
        function initPhase1() {
            const pool1 = document.getElementById('item-pool-1');
            expressions1.sort(() => Math.random() - 0.5).forEach(expr => {
                pool1.appendChild(createCard(expr, true));
            });
        }

        const zones1 = ['zone-single', 'zone-multi'];
        zones1.forEach(zoneId => {
            const zone = document.getElementById(zoneId);
            zone.addEventListener('dragover', (e) => e.preventDefault());
            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                const phase = e.dataTransfer.getData('phase');
                if (phase !== '1') return;

                const id = e.dataTransfer.getData('text/plain');
                const itemData = expressions1.find(ex => ex.id == id);
                
                const isCorrect = (zoneId === 'zone-single' && itemData.type === 'single') || 
                                  (zoneId === 'zone-multi' && itemData.type === 'multi');

                if (isCorrect) {
                    const card = document.querySelector(`[data-id="${id}"]`);
                    const targetList = zoneId === 'zone-single' ? 'single-variable-list' : 'multi-variable-list';
                    document.getElementById(targetList).appendChild(card);
                    card.draggable = false;
                    card.classList.replace('border-gray-200', zoneId === 'zone-single' ? 'border-blue-400' : 'border-purple-400');
                    card.classList.add('scale-90', 'cursor-default');
                    
                    completedCount1++;
                    if (completedCount1 === expressions1.length) {
                        notebook.classList.remove('hidden');
                        setTimeout(() => {
                            notebook.classList.remove('opacity-0', 'translate-y-10');
                            notebook.scrollIntoView({ behavior: 'smooth' });
                        }, 50);
                        showSuccessEffect(20);
                    }
                } else {
                    showErrorMessage("Sai nh√≥m r·ªìi b·∫°n ∆°i! ‚ùå");
                }
            });
        });

        // --- CHUY·ªÇN PHASE ---
        function startPhase2() {
            document.getElementById('phase-1').classList.add('hidden');
            document.getElementById('notebook-actions').classList.add('hidden');
            
            const phase2 = document.getElementById('phase-2');
            phase2.classList.remove('hidden');
            
            // Cu·ªôn l√™n ƒë·∫ßu trang n∆°i c√≥ s·ªï tay ƒë·ªÉ h·ªçc sinh v·ª´a l√†m v·ª´a xem l·∫°i
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            initPhase2();
        }

        // --- PHASE 2 LOGIC (Click & Destroy) ---
        function initPhase2() {
            const pool2 = document.getElementById('item-pool-2');
            pool2.innerHTML = ''; // Clear old items
            
            // ƒê·∫øm s·ªë l∆∞·ª£ng b·∫´y
            const traps = expressions2.filter(e => e.type === 'not_poly');
            totalTraps = traps.length;
            trapsFound = 0;
            document.getElementById('trap-count').innerText = totalTraps;

            expressions2.sort(() => Math.random() - 0.5).forEach(expr => {
                const card = document.createElement('button');
                card.className = "bg-blue-50 border-2 border-blue-200 p-4 rounded-xl shadow-sm text-xl sm:text-2xl math-text font-bold text-center text-gray-800 cursor-pointer transition-all duration-300 hover:scale-105 hover:bg-blue-100 hover:shadow-md flex items-center justify-center min-h-[80px] w-full focus:outline-none";
                card.innerText = expr.val;
                card.dataset.id = expr.id;
                card.dataset.type = expr.type;

                card.addEventListener('click', function() {
                    // N·∫øu th·∫ª ƒë√£ b·ªã ti√™u di·ªát r·ªìi th√¨ kh√¥ng click ƒë∆∞·ª£c n·ªØa
                    if (this.classList.contains('destroyed')) return;

                    if (expr.type === 'not_poly') {
                        // B·∫•m ƒê√öNG b·∫´y
                        this.classList.add('destroyed', 'bg-red-100', 'border-red-500', 'text-red-700', 'scale-95', 'opacity-80');
                        this.classList.remove('bg-blue-50', 'border-blue-200', 'hover:scale-105', 'hover:bg-blue-100');
                        this.innerText = 'üí• ' + expr.val;
                        
                        trapsFound++;
                        document.getElementById('trap-count').innerText = totalTraps - trapsFound;
                        showSuccessEffect(5); // Ph√°o gi·∫•y nh·ªè khi di·ªát ƒë∆∞·ª£c 1 b·∫´y

                        // Ki·ªÉm tra chi·∫øn th·∫Øng
                        if (trapsFound === totalTraps) {
                            // Highlight xanh c√°c ƒëa th·ª©c th·∫≠t c√≤n s√≥t l·∫°i
                            document.querySelectorAll('#item-pool-2 button:not(.destroyed)').forEach(c => {
                                c.classList.remove('bg-blue-50', 'border-blue-200', 'hover:scale-105');
                                c.classList.add('bg-green-100', 'border-green-500', 'text-green-800', 'cursor-default');
                                c.innerText = '‚úÖ ' + c.innerText;
                            });

                            const finalSection = document.getElementById('final-section');
                            finalSection.classList.remove('hidden');
                            setTimeout(() => {
                                finalSection.scrollIntoView({ behavior: 'smooth' });
                            }, 500);
                            showSuccessEffect(40);
                        }
                    } else {
                        // B·∫•m NH·∫¶M ƒëa th·ª©c th·∫≠t
                        this.classList.add('animate-shake', 'border-red-500', 'bg-red-50');
                        showErrorMessage("C·∫©n th·∫≠n! ƒê√¢y L√Ä m·ªôt ƒëa th·ª©c 1 bi·∫øn. ƒê·ª´ng lo·∫°i b·ªè n√≥! ‚ùå");
                        
                        // X√≥a hi·ªáu ·ª©ng rung sau khi ch·∫°y xong
                        setTimeout(() => {
                            this.classList.remove('animate-shake', 'border-red-500', 'bg-red-50');
                        }, 500);
                    }
                });

                pool2.appendChild(card);
            });
        }

        // --- TI·ªÜN √çCH ---
        function showErrorMessage(text) {
            const message = document.createElement('div');
            message.innerText = text;
            message.className = "fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-full shadow-2xl transition-opacity duration-500 z-50 font-bold";
            document.body.appendChild(message);
            setTimeout(() => {
                message.style.opacity = '0';
                setTimeout(() => message.remove(), 500);
            }, 2000);
        }

        function showSuccessEffect(count = 20) {
            const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444'];
            for(let i=0; i<count; i++) {
                const conf = document.createElement('div');
                conf.className = "fixed pointer-events-none z-50";
                conf.style.left = Math.random() * 100 + 'vw';
                conf.style.top = '-10px';
                conf.style.width = (Math.random() * 10 + 5) + 'px';
                conf.style.height = (Math.random() * 10 + 5) + 'px';
                conf.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                conf.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";
                document.body.appendChild(conf);
                
                const anim = conf.animate([
                    { transform: 'translateY(0) rotate(0deg)', opacity: 1 },
                    { transform: `translateY(100vh) rotate(${Math.random() * 720}deg)`, opacity: 0 }
                ], { duration: 2000 + Math.random() * 3000, easing: 'cubic-bezier(.37,0,.63,1)' });
                anim.onfinish = () => conf.remove();
            }
        }

        // Kh·ªüi ch·∫°y game
        window.onload = initPhase1;
    </script>
</body>
</html>
